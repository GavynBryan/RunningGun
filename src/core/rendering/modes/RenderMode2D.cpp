#include <core/rendering/modes/RenderMode2D.h>\n#include <core/rendering/IGraphicsAPI.h>\n#include <core/rendering/RenderableRegistry.h>\n#include <core/rendering/Camera.h>\n#include <core/rendering/IRenderable.h>\n\nvoid RenderMode2D::RenderScene(IGraphicsAPI& graphics, RenderableRegistry& registry, Camera& camera)\n{\n\t// Sync camera to graphics API (Camera is the single source of truth)\n\tgraphics.SetCamera(camera.GetCameraData());\n\n\t// Get renderables (already sorted by layer in registry)\n\tconst auto& renderables = registry.GetRenderables();\n\n\t// Submit sprites to graphics API\n\tfor (const auto* renderable : renderables) {\n\t\tif (!renderable || !renderable->IsVisible()) {\n\t\t\tcontinue;\n\t\t}\n\n\t\tTransform2D transform = renderable->GetTransform();\n\n\t\tSpriteRenderParams params;\n\n\t\t// Source rect\n\t\tif (renderable->HasSourceRect()) {\n\t\t\tconst auto& src = renderable->GetSourceRect();\n\t\t\tparams.SourceRect = Rectf(\n\t\t\t\tstatic_cast<float>(src.x),\n\t\t\t\tstatic_cast<float>(src.y),\n\t\t\t\tstatic_cast<float>(src.width),\n\t\t\t\tstatic_cast<float>(src.height)\n\t\t\t);\n\t\t}\n\n\t\t// Dest rect from transform and sprite size\n\t\tconst Vec2& size = renderable->GetSize();\n\n\t\tparams.DestRect = Rectf(\n\t\t\ttransform.Position.x, \n\t\t\ttransform.Position.y, \n\t\t\tsize.x * transform.Scale.x, \n\t\t\tsize.y * transform.Scale.y\n\t\t);\n\t\tparams.FlipX = renderable->GetFlipX();\n\t\tparams.FlipY = renderable->GetFlipY();\n\t\tparams.Rotation = transform.Rotation;\n\t\tparams.Origin = renderable->GetOrigin();\n\n\t\tgraphics.DrawSprite(renderable->GetTexture(), params);\n\t}\n}
